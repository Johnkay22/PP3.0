<!DOCTYPE html><html><head><base href="https://johnkay22.github.io/PP3.0/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Poop Profit: Your Ultimate Bathroom Companion</title>
<style>
    :root {
        --primary-color: #1a1a2e;
        --secondary-color: #16213e;
        --accent-color: #0f3460;
        --text-color: #00CED1;
        --light-text: #f1f1f1;
        --neon-blue: #3498db;
        --light-grey: #e0e0e0;
    }

    body {
        background-image: url('/a/470521ba-823c-4b91-90dd-79d881ada224');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        color: var(--light-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Roboto', sans-serif;
    }

    .app-container {
        background-color: rgba(26, 26, 46, 0.8);
        border-radius: 10px;
        padding: 20px;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 60px;
    }

    header {
        position: relative;
        width: 100%;
        padding: 0;
        margin-bottom: 0.5rem;
        overflow: hidden;
        border-radius: 10px;
    }

    .header-image {
        width: 100%;
        height: auto;
        display: block;
    }

    .turd-token-balance {
        position: fixed;
        top: 20px;
        right: 10px;
        transform: none;
        z-index: 1000;
        font-size: 1.2em;
        padding: 10px;
        background-color: rgba(22, 33, 62, 0.9);
        border-radius: 10px;
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .turd-token-icon {
        width: 30px;
        height: 30px;
        margin-right: 5px;
    }

    main {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .interface-container {
        display: flex;
        flex-direction: column;
    }

    .tabs {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        width: 100%;
        background-color: rgba(22, 33, 62, 0.9);
        padding: 20px 0;
        border-radius: 10px 10px 0 0;
        position: relative;
    }

    .tab {
        padding: 15px;
        background-color: transparent;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 4px solid transparent;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .tab.active {
        background-color: var(--primary-color);
        border-bottom: 4px solid var(--neon-blue);
    }

    .tab:hover {
        background-color: var(--accent-color);
    }

    .tab-icon {
        width: 60px;
        height: 60px;
        transition: transform 0.3s ease;
    }

    @media (min-width: 768px) {
        .tab-icon {
            width: 80px;  
            height: 80px;
        }

        .tab {
            padding: 20px;
        }
    }

    .tab:hover .tab-icon {
        transform: scale(1.1);
    }

    .tab-content-container {
        flex: 1;
        background-color: rgba(26, 26, 46, 0.9);
        border-radius: 0 10px 10px 0;
        padding: 20px;
    }

    .tab-content {
        display: none;
        background-color: var(--primary-color);
        border: none;
        border-radius: 0;
        padding: 0;
        transition: opacity 0.3s ease-in-out;
        opacity: 1;
    }

    .tab-content.active {
        display: block;
    }

    .tab-content.fade-out {
        opacity: 0;
    }

    .calculator-container {
        background-color: transparent;
        box-shadow: none;
        padding: 0;
    }

    .calculator-title {
        font-size: 2.5rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 1rem;
        color: var(--neon-blue);
        text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue);
    }

    .calculator-description {
        font-size: 1.2rem;
        text-align: center;
        color: var(--light-grey);
        margin-bottom: 2rem;
    }

    .input-section {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
    }

    .wage-input-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .toggle-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
        margin-right: 15px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--accent-color);
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: var(--neon-blue);
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    #toggleLabel {
        font-size: 1rem;
        color: var(--light-text);
    }

    .input-group {
        margin-bottom: 15px;
    }

    .input-label {
        display: block;
        margin-bottom: 5px;
        color: var(--light-grey);
        font-size: 0.9rem;
    }

    .input-field {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--accent-color);
        border-radius: 5px;
        background-color: var(--secondary-color);
        color: var(--light-text);
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }

    .input-field:focus {
        outline: none;
        border-color: var(--neon-blue);
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
    }

    .error-message {
        color: #ff4d4d;
        font-size: 0.8rem;
        margin-top: 5px;
        display: none;
    }

    @media (min-width: 768px) {
        #salaryHoursInputs, #hourlyWageInput {
            display: flex;
            gap: 20px;
        }

        .input-group {
            flex: 1;
        }
    }

    .hourly-wage {
        text-align: center;
        font-size: 1.2rem;
        margin-top: 1rem;
        color: var(--text-color);
    }

    .timer-section {
        text-align: center;
        margin-bottom: 2rem;
    }

    .poop-emoji {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .poop-emoji.wiggle {
        animation: wiggle 0.5s infinite;
    }

    .timer-display {
        font-size: 3rem;
        font-weight: bold;
        color: var(--text-color);
        margin-bottom: 1rem;
    }

    .timer-button {
        padding: 15px 30px;
        font-size: 1.2rem;
        border: none;
        border-radius: 50px;
        background-color: var(--neon-blue);
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .timer-button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px var(--neon-blue);
    }

    .earnings-display {
        font-size: 1.2rem;
        color: var(--text-color);
        margin-top: 1rem;
        font-weight: bold;
    }

    .poop-log-section {
        text-align: center;
        max-height: 300px;
        overflow-y: auto;
    }

    .poop-log-title {
        font-size: 1.5rem;
        color: var(--light-grey);
        margin-bottom: 1rem;
    }

    .poop-log-placeholder {
        color: var(--light-grey);
        font-style: italic;
    }

    .log-entry {
        background-color: var(--secondary-color);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    .log-entry p {
        margin: 5px 0;
    }

    .log-entry .log-date {
        font-weight: bold;
        color: var(--neon-blue);
    }

    .log-entry .log-duration,
    .log-entry .log-earnings,
    .log-entry .log-rating {
        color: var(--light-grey);
    }

    .delete-button {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: #ff4d4d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .delete-button:hover {
        background-color: #ff1a1a;
    }

    .card {
        background-color: rgba(22, 33, 62, 0.8);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    @keyframes wiggle {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(-5deg); }
        75% { transform: rotate(5deg); }
        100% { transform: rotate(0deg); }
    }

    @media (max-width: 767px) {
        .tabs {
            flex-wrap: wrap;
        }

        .tab {
            flex: 1 0 25%;
            max-width: 25%;
        }

        .turd-token-balance {
            position: fixed;
            top: 10px;
            right: 10px;
            width: auto;
        }
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: var(--secondary-color);
        margin: 15% auto;
        padding: 20px;
        border: 1px solid var(--accent-color);
        width: 300px;
        border-radius: 10px;
        text-align: center;
    }

    .emoji-rating {
        font-size: 2rem;
        margin: 20px 0;
    }

    .poopEmoji {
        cursor: pointer;
        opacity: 0.5;
        transition: opacity 0.3s ease;
    }

    .poopEmoji:hover {
        opacity: 1;
    }

    #submitRatingButton {
        padding: 10px 20px;
        background-color: var(--neon-blue);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #submitRatingButton:hover {
        background-color: #2980b9;
    }

    .congrats-message {
        color: #4CAF50;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 1.1em;
    }

    #shareModal .modal-content {
        width: 400px;
    }

    #shareModal button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        background-color: var(--neon-blue);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #shareModal button:hover {
        background-color: #2980b9;
    }

    #twitterShareButton {
        background-color: #1DA1F2;
    }

    #facebookShareButton {
        background-color: #4267B2;
    }

    #smsShareButton {
        background-color: #25D366;
    }

    #statisticsSection {
        margin-bottom: 20px;
    }

    .statistics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
        background: rgba(26, 26, 46, 0.4);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(52, 152, 219, 0.2);
    }

    .stat-card {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card:before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            45deg,
            transparent,
            rgba(52, 152, 219, 0.1),
            transparent
        );
        transform: rotate(45deg);
        animation: shine 3s infinite;
    }

    .stat-card.featured {
        background: linear-gradient(145deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.2));
        border: 2px solid rgba(52, 152, 219, 0.5);
        padding: 30px;
    }

    .stat-card.featured p {
        font-size: 3.5rem;
        background: linear-gradient(45deg, #3498db, #2ecc71);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 10px;
    }

    .stat-card:not(.featured) p {
        font-size: 1.8rem;
        color: var(--text-color);
        text-shadow: 0 0 10px rgba(0, 206, 209, 0.5);
        margin-bottom: 5px;
    }

    .stat-card span {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    @keyframes shine {
        0% {
            left: -100%;
        }
        20% {
            left: 100%;
        }
        100% {
            left: 100%;
        }
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3), 
                    0 0 15px rgba(52, 152, 219, 0.5);
    }

    #statsChart {
        background: rgba(26, 26, 46, 0.8);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(52, 152, 219, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        backdrop-filter: blur(4px);
    }

    .date-range-controls {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(52, 152, 219, 0.2);
        backdrop-filter: blur(10px);
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .quick-filter-btn {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        padding: 12px 24px;
        border-radius: 10px;
        color: var(--light-text);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .quick-filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        border-color: rgba(52, 152, 219, 0.6);
    }

    .quick-filter-btn.active {
        background: linear-gradient(145deg, var(--neon-blue), #2980b9);
        border-color: var(--neon-blue);
        box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
    }

    #startDate, #endDate {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        border-radius: 10px;
        padding: 12px;
        color: var(--light-text);
        transition: all 0.3s ease;
    }

    #startDate:focus, #endDate:focus {
        outline: none;
        border-color: var(--neon-blue);
        box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
    }

    #filterStats, #resetStats {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        border-radius: 10px;
        padding: 12px 24px;
        color: var(--light-text);
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    #filterStats {
        background: linear-gradient(145deg, var(--neon-blue), #2980b9);
    }

    #filterStats:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
    }

    #resetStats {
        background: linear-gradient(145deg, #e74c3c, #c0392b);
        border-color: #e74c3c;
    }

    #resetStats:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
    }

    .date-range-divider {
        color: var(--light-text);
        opacity: 0.7;
        font-size: 0.9em;
    }

    .date-range-header {
        color: var(--light-text);
        font-size: 1.2em;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    }

    .game-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px;
    }

    .game-link {
        display: block;
        text-align: center;
    }

    .game-image {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        transition: transform 0.3s ease;
    }

    .game-image:hover {
        transform: scale(1.05);
    }

    .confirm-dialog {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
    }

    .confirm-dialog-content {
        background-color: var(--secondary-color);
        border-radius: 10px;
        padding: 20px;
        width: 300px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .confirm-dialog-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }

    .confirm-dialog button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .confirm-dialog .confirm {
        background-color: #ff4d4d;
        color: white;
    }

    .confirm-dialog .cancel {
        background-color: var(--neon-blue);
        color: white;
    }

    .confirm-dialog button:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let currentUser = null;
let annualSalaryInput;
let weeklyHoursInput;
let wageToggle;
let hourlyWageField;
let hourlyWageDisplay;
let hourlyWage = 0;

let stats = {
    totalSessions: 0,
    totalPoopTime: 0,
    totalEarnings: 0,
    firstSessionDate: null,
    lastSessionDate: null
};

let turdTokens = 0;
let lastAwardDate = null;

let timerInterval;
let seconds = 0;
let isTimerRunning = false;

function formatTime(totalSeconds) {
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
}

function updateHourlyWage() {
    if (wageToggle.checked) {
        hourlyWage = parseFloat(hourlyWageField.value) || 0;
    } else {
        const annualSalary = parseFloat(annualSalaryInput.value) || 0;
        const weeklyHours = parseFloat(weeklyHoursInput.value) || 0;
        
        if (weeklyHours > 0) {
            hourlyWage = (annualSalary / 52) / weeklyHours;
        } else {
            hourlyWage = 0;
        }
    }
    hourlyWageDisplay.textContent = `Your hourly wage: $${hourlyWage.toFixed(2)}`;
    saveUserData();
}

function saveUserData() {
    const userData = {
        hourlyWage: hourlyWage,
        annualSalary: annualSalaryInput.value,
        weeklyHours: weeklyHoursInput.value,
        hourlyWageInput: hourlyWageField.value,
        wageToggle: wageToggle.checked,
        stats: stats,
        turdTokens: turdTokens,
        lastAwardDate: lastAwardDate,
        poopLogs: Array.from(poopLog.children).map(entry => entry.outerHTML)
    };
    localStorage.setItem('currentUser', JSON.stringify(userData));
}

function loadUserData() {
    const savedData = localStorage.getItem('currentUser');
    if (savedData) {
        const userData = JSON.parse(savedData);
        
        hourlyWage = userData.hourlyWage || 0;
        annualSalaryInput.value = userData.annualSalary || '';
        weeklyHoursInput.value = userData.weeklyHours || '';
        hourlyWageField.value = userData.hourlyWageInput || '';
        wageToggle.checked = userData.wageToggle || false;
        
        if (wageToggle.checked) {
            document.getElementById('salaryHoursInputs').style.display = 'none';
            document.getElementById('hourlyWageInput').style.display = 'block';
            document.getElementById('toggleLabel').textContent = 'Hourly Wage';
        }

        stats = userData.stats || {
            totalSessions: 0,
            totalPoopTime: 0,
            totalEarnings: 0,
            firstSessionDate: null,
            lastSessionDate: null
        };

        turdTokens = userData.turdTokens || 0;
        lastAwardDate = userData.lastAwardDate;
        
        if (userData.poopLogs && userData.poopLogs.length > 0) {
            poopLogPlaceholder.style.display = 'none';
            poopLog.innerHTML = userData.poopLogs.join('');
            poopLog.querySelectorAll('.delete-button').forEach(button => {
                const logEntry = button.parentElement;
                const durationText = logEntry.querySelector('.log-duration').textContent;
                const duration = parseInt(durationText.match(/\d+/g).reduce((acc, val) => acc * 60 + parseInt(val), 0));
                const earnings = parseFloat(logEntry.querySelector('.log-earnings').textContent.replace(/[^0-9.-]+/g, ''));
                
                button.onclick = () => confirmDelete(logEntry, duration, earnings);
            });
        }

        displayStatistics();
        updateTurdTokenDisplay();
    }
}

function checkLoginStatus() {
    if (!localStorage.getItem('currentUser')) {
        window.location.href = '/login.html';
    }
}

function isFirstSessionOfDay() {
    const today = new Date().toDateString();
    const lastAwardDay = lastAwardDate ? new Date(lastAwardDate).toDateString() : null;
    
    if (today !== lastAwardDay) {
        lastAwardDate = new Date().toISOString();
        saveUserData();
        return true;
    }
    return false;
}

function showTokenAwardNotification() {
    const notification = document.createElement('div');
    notification.className = 'token-award-notification';
    notification.textContent = '🎉 You earned 1 Turd Token for your first poop of the day!';
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

function updateTurdTokenDisplay() {
    const tokenDisplay = document.querySelector('.turd-token-balance span');
    if (tokenDisplay) {
        tokenDisplay.textContent = `TT: ${turdTokens}`;
    }
    localStorage.setItem('turdTokens', turdTokens);
}

function displayStatistics(filtered = false, filteredStats = null) {
    const statsToUse = filtered ? filteredStats : stats;
    const totalTime = statsToUse.totalPoopTime;
    const totalHours = Math.floor(totalTime / 3600);
    const totalMinutes = Math.floor((totalTime % 3600) / 60);
    const totalSecs = totalTime % 60;

    const avgPoopTime = statsToUse.totalSessions > 0 ? totalTime / statsToUse.totalSessions : 0;
    const avgHours = Math.floor(avgPoopTime / 3600);
    const avgMinutes = Math.floor((avgPoopTime % 3600) / 60);
    const avgSecs = Math.floor(avgPoopTime % 60);

    const totalDays = statsToUse.firstSessionDate && statsToUse.lastSessionDate
        ? Math.max(1, Math.ceil((statsToUse.lastSessionDate - statsToUse.firstSessionDate) / (1000 * 60 * 60 * 24)))
        : 1;
    const avgPoopsPerDay = statsToUse.totalSessions > 0 ? (statsToUse.totalSessions / totalDays).toFixed(2) : '0.00';

    document.getElementById('totalSessions').textContent = statsToUse.totalSessions;
    document.getElementById('totalTime').textContent = `${String(totalHours).padStart(2, '0')}:${String(totalMinutes).padStart(2, '0')}:${String(totalSecs).padStart(2, '0')}`;
    document.getElementById('totalEarnings').textContent = `$${statsToUse.totalEarnings.toFixed(2)}`;
    document.getElementById('avgPoopTime').textContent = `${String(avgHours).padStart(2, '0')}:${String(avgMinutes).padStart(2, '0')}:${String(avgSecs).padStart(2, '0')}`;
    document.getElementById('avgEarnings').textContent = `$${(statsToUse.totalSessions > 0 ? statsToUse.totalEarnings / statsToUse.totalSessions : 0).toFixed(2)}`;
    document.getElementById('avgPoopsPerDay').textContent = avgPoopsPerDay;

    updateStatsChart(statsToUse);
}

function updateStatsChart(statsData) {
    const ctx = document.getElementById('statsChart').getContext('2d');
    
    if (window.statsBarChart) {
        window.statsBarChart.destroy();
    }

    window.statsBarChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Total Sessions', 'Avg Poops/Day', 'Total Hours', 'Avg Minutes/Poop', 'Total Earnings ($)'],
            datasets: [{
                label: 'Statistics',
                data: [
                    statsData.totalSessions,
                    parseFloat((statsData.totalSessions / Math.max(1, Math.ceil((statsData.lastSessionDate - statsData.firstSessionDate) / (1000 * 60 * 60 * 24)))).toFixed(2)),
                    Math.floor(statsData.totalPoopTime / 3600),
                    Math.floor((statsData.totalPoopTime / statsData.totalSessions / 60) || 0),
                    parseFloat(statsData.totalEarnings.toFixed(2))
                ],
                backgroundColor: [
                    'rgba(52, 152, 219, 0.6)',
                    'rgba(46, 204, 113, 0.6)',
                    'rgba(155, 89, 182, 0.6)',
                    'rgba(241, 196, 15, 0.6)',
                    'rgba(231, 76, 60, 0.6)'
                ],
                borderColor: [
                    'rgba(52, 152, 219, 1)',
                    'rgba(46, 204, 113, 1)',
                    'rgba(155, 89, 182, 1)',
                    'rgba(241, 196, 15, 1)',
                    'rgba(231, 76, 60, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#f1f1f1'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#f1f1f1'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

function filterStatsByDateRange(startDate, endDate) {
    const start = new Date(startDate);
    start.setHours(0, 0, 0, 0);
    const end = new Date(endDate);
    end.setHours(23, 59, 59, 999);

    const filteredStats = {
        totalSessions: 0,
        totalPoopTime: 0,
        totalEarnings: 0,
        firstSessionDate: null,
        lastSessionDate: null
    };

    const logEntries = Array.from(poopLog.children);
    
    logEntries.forEach(entry => {
        const dateText = entry.querySelector('.log-date').textContent;
        const entryDate = new Date(dateText);
        
        if (entryDate >= start && entryDate <= end) {
            const durationText = entry.querySelector('.log-duration').textContent;
            const [hours, minutes, seconds] = durationText.match(/\d+/g).map(Number);
            const totalSeconds = (hours * 3600) + (minutes * 60) + seconds;
            
            const earningsText = entry.querySelector('.log-earnings').textContent;
            const earnings = parseFloat(earningsText.replace(/[^0-9.-]+/g, ''));
            
            filteredStats.totalSessions++;
            filteredStats.totalPoopTime += totalSeconds;
            filteredStats.totalEarnings += earnings;
            
            if (!filteredStats.firstSessionDate || entryDate < filteredStats.firstSessionDate) {
                filteredStats.firstSessionDate = entryDate;
            }
            if (!filteredStats.lastSessionDate || entryDate > filteredStats.lastSessionDate) {
                filteredStats.lastSessionDate = entryDate;
            }
        }
    });

    displayStatistics(true, filteredStats);
}

function confirmDelete(logEntry, duration, earnings) {
    const confirmDialog = document.querySelector('.confirm-dialog');
    confirmDialog.style.display = 'block';

    const confirmButton = confirmDialog.querySelector('.confirm');
    const cancelButton = confirmDialog.querySelector('.cancel');

    const handleDelete = () => {
        stats.totalSessions--;
        stats.totalPoopTime -= duration;
        stats.totalEarnings -= earnings;

        logEntry.remove();

        if (poopLog.children.length === 0) {
            document.getElementById('poopLogPlaceholder').style.display = 'block';
        }

        updateDateRangeStats();
        displayStatistics();
        saveUserData();
        confirmDialog.style.display = 'none';

        confirmButton.removeEventListener('click', handleDelete);
        cancelButton.removeEventListener('click', handleCancel);
    };

    const handleCancel = () => {
        confirmDialog.style.display = 'none';

        confirmButton.removeEventListener('click', handleDelete);
        cancelButton.removeEventListener('click', handleCancel);
    };

    confirmButton.addEventListener('click', handleDelete);
    cancelButton.addEventListener('click', handleCancel);
}

function updateDateRangeStats() {
    if (stats.totalSessions === 0) {
        stats.firstSessionDate = null;
        stats.lastSessionDate = null;
    } else {
        const entries = Array.from(poopLog.children);
        if (entries.length > 0) {
            const dates = entries.map(entry => new Date(entry.querySelector('.log-date').textContent));
            stats.firstSessionDate = new Date(Math.min(...dates));
            stats.lastSessionDate = new Date(Math.max(...dates));
        }
    }
}

function startTimer() {
    const timerButton = document.getElementById('timerButton');
    const timerDisplay = document.getElementById('timerDisplay');
    const earningsDisplay = document.getElementById('earningsDisplay');
    const poopEmoji = document.querySelector('.poop-emoji');
    
    if (!isTimerRunning) {
        isTimerRunning = true;
        timerButton.textContent = 'Stop Pooping';
        poopEmoji.classList.add('wiggle');
        
        timerInterval = setInterval(() => {
            seconds++;
            timerDisplay.textContent = formatTime(seconds);
            const earnings = ((hourlyWage / 3600) * seconds).toFixed(2);
            earningsDisplay.textContent = `Current earnings: $${earnings}`;
        }, 1000);
    } else {
        isTimerRunning = false;
        clearInterval(timerInterval);
        timerButton.textContent = 'Start Pooping';
        poopEmoji.classList.remove('wiggle');
        openRatingModal();
        seconds = 0;
        timerDisplay.textContent = '00:00:00';
        earningsDisplay.textContent = '';
    }
}

function updateStatistics(duration, earnings) {
    stats.totalSessions++;
    stats.totalPoopTime += duration;
    stats.totalEarnings += parseFloat(earnings);

    const currentDate = new Date();
    if (!stats.firstSessionDate || currentDate < new Date(stats.firstSessionDate)) {
        stats.firstSessionDate = currentDate;
    }
    if (!stats.lastSessionDate || currentDate > new Date(stats.lastSessionDate)) {
        stats.lastSessionDate = currentDate;
    }

    displayStatistics();
    saveUserData();
}

document.addEventListener('DOMContentLoaded', () => {
    annualSalaryInput = document.getElementById('annualSalary');
    weeklyHoursInput = document.getElementById('weeklyHours');
    wageToggle = document.getElementById('wageToggle');
    hourlyWageField = document.getElementById('hourlyWageField');
    hourlyWageDisplay = document.getElementById('hourlyWage');

    const allTimeStatsBtn = document.getElementById('allTimeStats');
    const todayStatsBtn = document.getElementById('todayStats');
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    const filterButton = document.getElementById('filterStats');
    const resetButton = document.getElementById('resetStats');

    const ratingModal = document.getElementById('ratingModal');
    const congratsMessage = document.getElementById('congratsMessage');
    const poopEmojis = document.querySelectorAll('.poopEmoji');
    const submitRatingButton = document.getElementById('submitRatingButton');
    let selectedRating = 0;

    poopEmojis.forEach(emoji => {
        emoji.addEventListener('click', () => {
            selectedRating = parseInt(emoji.dataset.rating);
            poopEmojis.forEach((e, index) => {
                e.style.opacity = index < selectedRating ? '1' : '0.5';
            });
        });
    });

    submitRatingButton.addEventListener('click', () => {
        if (selectedRating > 0) {
            const latestEntry = poopLog.firstElementChild;
            if (latestEntry) {
                const ratingValue = latestEntry.querySelector('.rating-value');
                ratingValue.textContent = '💩'.repeat(selectedRating);
            }
            ratingModal.style.display = 'none';
        }
    });

    checkLoginStatus();
    lastAwardDate = localStorage.getItem('lastAwardDate');
    turdTokens = parseInt(localStorage.getItem('turdTokens')) || 0;
    updateTurdTokenDisplay();
    
    wageToggle.addEventListener('change', function() {
        if (this.checked) {
            salaryHoursInputs.style.display = 'none';
            hourlyWageInput.style.display = 'block';
            toggleLabel.textContent = 'Hourly Wage';
        } else {
            salaryHoursInputs.style.display = 'block';
            hourlyWageInput.style.display = 'none';
            toggleLabel.textContent = 'Salary & Hours';
        }
        updateHourlyWage();
    });

    const timerButton = document.getElementById('timerButton');
    timerButton.addEventListener('click', startTimer);

    todayStatsBtn.addEventListener('click', () => {
        clearActiveFilters();
        todayStatsBtn.classList.add('active');
        filterStatsByDay(new Date());
    });

    allTimeStatsBtn.addEventListener('click', () => {
        clearActiveFilters();
        allTimeStatsBtn.classList.add('active');
        displayStatistics();
    });

    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabId = tab.getAttribute('data-tab');
            const activeContent = document.querySelector('.tab-content.active');
            const newContent = document.getElementById(`${tabId}Tab`);

            activeContent.classList.add('fade-out');

            setTimeout(() => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active', 'fade-out'));
                
                tab.classList.add('active');
                newContent.classList.add('active', 'fade-out');

                void newContent.offsetWidth;

                newContent.classList.remove('fade-out');
            }, 300); 
        });
    });

    function filterStatsByDay(date) {
        const startOfDay = new Date(date);
        startOfDay.setHours(0, 0, 0, 0);
        
        const endOfDay = new Date(date);
        endOfDay.setHours(23, 59, 59, 999);
        
        filterStatsByDateRange(startOfDay.toISOString().split('T')[0], endOfDay.toISOString().split('T')[0]);
    }

    filterButton.addEventListener('click', () => {
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
        if (startDate && endDate) {
            filterStatsByDateRange(startDate, endDate);
        } else {
            alert('Please select both start and end dates.');
        }
    });

    resetButton.addEventListener('click', () => {
        clearActiveFilters();
        displayStatistics();
    });

    loadUserData();
    updateHourlyWage();
    displayStatistics();

    const turdTokenBalance = document.getElementById('turdTokenBalance');
    const turdTokenWallet = document.getElementById('turdTokenWallet');
    const walletBalance = document.getElementById('walletBalance');

    turdTokenBalance.addEventListener('click', () => {
        turdTokenWallet.style.display = 'block';
        walletBalance.textContent = turdTokens;
    });

    turdTokenWallet.querySelector('.close').addEventListener('click', () => {
        turdTokenWallet.style.display = 'none';
    });

    window.onclick = function(event) {
        if (event.target == ratingModal) {
            ratingModal.style.display = "none";
        }
        if (event.target == document.getElementById('shareModal')) {
            document.getElementById('shareModal').style.display = 'none';
        }
        if (event.target == document.getElementById('turdTokenWallet')) {
            document.getElementById('turdTokenWallet').style.display = 'none';
        }
        if (event.target == document.querySelector('.confirm-dialog')) {
            document.querySelector('.confirm-dialog').style.display = 'none';
        }
    }
});

function shareStatisticsOnTwitter() {
    const statsText = getShareableStats();
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(statsText)}`;
    window.open(twitterUrl, '_blank');
}

function shareStatisticsOnFacebook() {
    const statsText = getShareableStats();
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.poopprofit.com')}&quote=${encodeURIComponent(statsText)}`;
    window.open(facebookUrl, '_blank');
}

function shareStatisticsViaSMS() {
    const statsText = getShareableStats();
    window.open(`sms:?&body=${encodeURIComponent(statsText)}`);
}

function getShareableStats() {
    return `🚽 My Poop Profit Stats:
Total Sessions: ${stats.totalSessions}
Total Earnings: $${stats.totalEarnings.toFixed(2)}
Average Per Session: $${(stats.totalEarnings / stats.totalSessions || 0).toFixed(2)}
Track your bathroom breaks at www.poopprofit.com!`;
}

function clearActiveFilters() {
    document.getElementById('allTimeStats').classList.remove('active');
    document.getElementById('todayStats').classList.remove('active');
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
}

function openRatingModal() {
    const ratingModal = document.getElementById('ratingModal');
    const congratsMessage = document.getElementById('congratsMessage');
    const poopEmojis = document.querySelectorAll('.poopEmoji');
    
    const earnings = ((hourlyWage / 3600) * seconds).toFixed(2);
    congratsMessage.textContent = `Congratulations! You just earned $${earnings}!`;
    
    ratingModal.style.display = 'block';
    selectedRating = 0;
    
    poopEmojis.forEach(emoji => {
        emoji.style.opacity = '0.5';
    });

    if (isFirstSessionOfDay()) {
        turdTokens++;
        updateTurdTokenDisplay();
        showTokenAwardNotification();
    }

    const currentDate = new Date().toLocaleString();
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    logEntry.innerHTML = `
        <button class="delete-button">×</button>
        <p class="log-date">${currentDate}</p>
        <p class="log-duration">Duration: ${formatTime(seconds)}</p>
        <p class="log-earnings">Earnings: $${earnings}</p>
        <p class="log-rating">Rating: <span class="rating-value">Not rated</span></p>
    `;

    const deleteButton = logEntry.querySelector('.delete-button');
    deleteButton.onclick = () => confirmDelete(logEntry, seconds, earnings);

    if (poopLog.children.length === 0) {
        poopLogPlaceholder.style.display = 'none';
    }
    
    poopLog.insertBefore(logEntry, poopLog.firstChild);
    updateStatistics(seconds, earnings);
}
</script>
</head>
<body>
<div class="app-container">
    <header>
        <img src="/a/702fa063-850c-4841-81f6-abec165648cb" alt="Poop Profit Header" class="header-image">
    </header>
    <main>
        <div class="interface-container">
            <div class="turd-token-balance" id="turdTokenBalance">
                <img src="/a/eec143d0-440e-4d4f-8aa4-14768abc51ff" alt="Turd Token" class="turd-token-icon">
                <span>TT: 0</span>
            </div>
            <div class="tabs">
                <button class="tab active" data-tab="calculator">
                    <img src="/a/04395df3-81dc-428f-bde7-1c7593328909" alt="Calculator" class="tab-icon">
                </button>
                <button class="tab" data-tab="statistics">
                    <img src="/a/4ad8662c-36b7-4c86-b4de-5fec5c640fcf" alt="Bathroom Game 2" class="tab-icon">
                </button>
                <button class="tab" data-tab="games">
                    <img src="/a/4cbc406d-8cd5-40e4-8bb3-a33294c73d2d" alt="Statistics" class="tab-icon">
                </button>
                <button class="tab" data-tab="shop">
                    <img src="/a/276ad74c-c018-4883-af52-375468f014e8" alt="Shop" class="tab-icon">
                </button>
            </div>

            <div class="tab-content-container">
                <div id="calculatorTab" class="tab-content active">
                    <div class="calculator-container">
                        <h1 class="calculator-title">Poop Profit Calculator</h1>
                        <p class="calculator-description">Calculate how much money you make while pooping at work!</p>

                        <div class="input-section card">
                            <div class="wage-input-container">
                                <div class="toggle-container">
                                    <label class="switch">
                                        <input type="checkbox" id="wageToggle">
                                        <span class="slider round"></span>
                                    </label>
                                    <span id="toggleLabel">Salary &amp; Hours</span>
                                </div>
                                <div id="salaryHoursInputs">
                                    <div class="input-group">
                                        <label for="annualSalary" class="input-label">Annual Salary</label>
                                        <input type="number" id="annualSalary" class="input-field" placeholder="Enter your annual salary">
                                        <span id="salaryError" class="error-message"></span>
                                    </div>
                                    <div class="input-group">
                                        <label for="weeklyHours" class="input-label">Weekly Work Hours</label>
                                        <input type="number" id="weeklyHours" class="input-field" placeholder="Enter your weekly work hours">
                                        <span id="hoursError" class="error-message"></span>
                                    </div>
                                </div>
                                <div id="hourlyWageInput" style="display: none;">
                                    <div class="input-group">
                                        <label for="hourlyWageField" class="input-label">Hourly Wage</label>
                                        <input type="number" id="hourlyWageField" class="input-field" placeholder="Enter your hourly wage">
                                        <span id="hourlyWageError" class="error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hourly-wage" id="hourlyWage">Your hourly wage: $0.00</div>

                        <div class="timer-section card">
                            <div class="poop-emoji">💩</div>
                            <div class="timer-display" id="timerDisplay">00:00:00</div>
                            <button class="timer-button" id="timerButton">Start Pooping</button>
                            <div class="earnings-display" id="earningsDisplay"></div>
                        </div>

                        <div class="poop-log-section card">
                            <h2 class="poop-log-title">Poop Log</h2>
                            <p class="poop-log-placeholder" id="poopLogPlaceholder">No poop sessions logged yet!</p>
                            <div id="poopLog"></div>
                        </div>
                    </div>
                </div>

                <div id="statisticsTab" class="tab-content">
                    <h2></h2>
                    <div class="date-range-header">View Statistics By</div>
                    <div class="date-range-controls">
                        <button id="allTimeStats" class="quick-filter-btn">All Time</button>
                        <button id="todayStats" class="quick-filter-btn">Today</button>
                        <div class="date-range-divider">or</div>
                        <input type="date" id="startDate" placeholder="Start Date">
                        <input type="date" id="endDate" placeholder="End Date">
                        <button id="filterStats">Filter Range</button>
                        <button id="resetStats">Reset</button>
                    </div>
                    <div id="statisticsSection" class="statistics-grid">
                        <div class="stat-card featured" style="grid-column: 1 / -1; margin-bottom: 20px;">
    <p id="totalEarnings">$0.00</p>
    <span>Total Earnings</span>
</div>
                        <div class="stat-card">
                            <p id="totalSessions">0</p>
                            <span>Total Sessions</span>
                        </div>
                        <div class="stat-card">
                            <p id="totalTime">00:00:00</p>
                            <span>Total Time</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgPoopTime">00:00:00</p>
                            <span>Avg Poop Time</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgEarnings">$0.00</p>
                            <span>Avg Earnings</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgPoopsPerDay">0.00</p>
                            <span>Avg Poops/Day</span>
                        </div>
                    </div>
                    <canvas id="statsChart" width="400" height="300" style="margin-top: 20px; display: block;"></canvas>
                    <div class="share-statistics">
                        <button class="share-button twitter" onclick="shareStatisticsOnTwitter()">
                            <svg viewBox="0 0 24 24">
                                <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"></path>
                            </svg>
                        </button>
                        <button class="share-button facebook" onclick="shareStatisticsOnFacebook()">
                            <svg viewBox="0 0 24 24">
                                <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path>
                            </svg>
                        </button>
                        <button class="share-button sms" onclick="shareStatisticsViaSMS()">
                            <svg viewBox="0 0 24 24">
                                <path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 008 8v.5z"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="gamesTab" class="tab-content">
                    <h2></h2>
                    <div class="game-grid">
                        <a href="#game1" class="game-link">
                            <img src="/a/6c28f116-6394-4c9e-ac21-18ff1d1ce4ec" alt="Bathroom Game 1" class="game-image">
                        </a>
                        <a href="#game3" class="game-link">
                            <img src="/a/9efb1c9a-ac67-4a87-8cff-c8f8d425d276" alt="Bathroom Game 3" class="game-image">
                        </a>
                        <a href="#game2" class="game-link">
                            <img src="/a/b572882b-f179-4247-acb5-1761e8cc2f82" alt="Bathroom Game 2" class="game-image">
                        </a>
                    </div>
                </div>

                <div id="shopTab" class="tab-content">
                    <img src="/a/65598d67-010d-43da-ae35-217b1028625b" alt="Shop Items Coming Soon" class="shop-image" style="display: block; margin: 0 auto; max-width: 100%; height: auto;">
                </div>
            </div>
        </div>
    </main>
</div>

<div id="ratingModal" class="modal">
    <div class="modal-content">
        <p id="congratsMessage" class="congrats-message"></p>
        <h2>Rate Your Poop Session</h2>
        <div class="emoji-rating">
            <span class="poopEmoji" data-rating="1">💩</span>
            <span class="poopEmoji" data-rating="2">💩</span>
            <span class="poopEmoji" data-rating="3">💩</span>
            <span class="poopEmoji" data-rating="4">💩</span>
            <span class="poopEmoji" data-rating="5">💩</span>
        </div>
        <button id="submitRatingButton">Submit Rating</button>
    </div>
</div>

<div id="shareModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="document.getElementById('shareModal').style.display='none'">×</span>
        <h2>Share Your Earnings!</h2>
        <button id="twitterShareButton">Share on Twitter</button>
        <button id="facebookShareButton">Share on Facebook</button>
        <button id="smsShareButton">Share via SMS</button>
    </div>
</div>

<div class="confirm-dialog">
    <div class="confirm-dialog-content">
        <p>Are you sure you want to delete this log entry?</p>
        <div class="confirm-dialog-buttons">
            <button class="confirm">Yes, delete</button>
            <button class="cancel">Cancel</button>
        </div>
    </div>
</div>

<div id="turdTokenWallet" class="modal">
    <div class="modal-content">
        <span class="close">×</span>
        <h2>Turd Token Wallet</h2>
        <div class="wallet-content">
            <img src="/a/eec143d0-440e-4d4f-8aa4-14768abc51ff" alt="Turd Token" class="wallet-token-icon" style="width: 64px; height: 64px; margin: 10px auto; display: block;">
            <p>Balance: <span id="walletBalance">0</span> TT</p>
        </div>
        <p style="text-align: center; margin-top: 20px; font-style: italic;">COMING SOON</p>
    </div>
</div>

</body></html>
